<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generator zdjęć z ramką — Konferencja</title>
  <meta name="description" content="Wgraj swoje zdjęcie, dopasuj je do ramki i pobierz gotową grafikę do mediów społecznościowych." />
  <style>
    body{margin:0;background:#fff;color:#000;font-family:sans-serif}
    .wrap{max-width:1100px;margin:24px auto;padding:16px}
    header{margin-bottom:14px}
    canvas{max-width:100%;height:auto;display:block;margin:auto;border:1px solid #ccc;border-radius:8px}
    .controls{margin-top:20px;display:grid;gap:10px;max-width:400px}
    .btn{padding:8px 12px;background:#4f8cff;color:#fff;border:none;border-radius:6px;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .slider{width:100%}
    footer{margin-top:40px;text-align:center;font-size:14px;color:#444}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Generator zdjęć z ramką — Konferencja</h1>
      <p>Wgraj swoje zdjęcie, dopasuj do ramki i pobierz gotowy obraz (4:5).</p>
    </header>

    <canvas id="canvas"></canvas>

    <div class="controls">
      <input id="file" type="file" accept="image/*" />
      <label for="zoom">Powiększenie</label>
      <input id="zoom" class="slider" type="range" min="1" max="4" value="1" step="0.001" />
      <button class="btn" id="rotate">Obróć 90°</button>
      <button class="btn" id="reset">Wycentruj</button>
      <button class="btn" id="downloadPng">Pobierz PNG</button>
      <button class="btn" id="downloadJpg">Pobierz JPG</button>
    </div>

    <footer>
      © 2025 <a href="https://konferencjarozwinskrzydla.pl" target="_blank">konferencjarozwinskrzydla.pl</a>
    </footer>
  </div>

<script>
(() => {
  const FRAME_SRC = 'Ramka nakładka.png'; // Twoja ramka 1080x1350 (4:5)

  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const fileInput = document.getElementById('file');
  const rotateBtn = document.getElementById('rotate');
  const resetBtn = document.getElementById('reset');
  const zoomSlider = document.getElementById('zoom');
  const downloadPngBtn = document.getElementById('downloadPng');
  const downloadJpgBtn = document.getElementById('downloadJpg');

  const state = {
    frame: new Image(),
    frameLoaded: false,
    img: new Image(),
    imgLoaded: false,
    angle: 0,
    scale: 1,
    minScale: 1,
    x: 0,
    y: 0,
    isPanning: false,
    lastX: 0,
    lastY: 0
  };

  state.frame.onload = () => {
    state.frameLoaded = true;
    canvas.width = state.frame.width;
    canvas.height = state.frame.height;
    centerImage();
    draw();
  };
  state.frame.src = FRAME_SRC;

  function rotatedDims(){
    const a = (state.angle % 180 === 0);
    return a ? {w: state.img.width, h: state.img.height} : {w: state.img.height, h: state.img.width};
  }
  function computeMinScale(){
    if(!state.imgLoaded || !state.frameLoaded) return 1;
    const {w: iw, h: ih} = rotatedDims();
    return Math.max(canvas.width / iw, canvas.height / ih);
  }
  function centerImage(){
    if(!state.imgLoaded) return;
    state.minScale = computeMinScale();
    state.scale = state.minScale;
    zoomSlider.min = state.minScale.toFixed(3);
    zoomSlider.value = state.scale.toFixed(3);
    state.x = 0; state.y = 0;
  }
  function clampPan(){
    if(!state.imgLoaded) return;
    const {w: iw, h: ih} = rotatedDims();
    const dw = iw * state.scale;
    const dh = ih * state.scale;
    const minX = Math.min(0, (canvas.width - dw)/2);
    const maxX = Math.max(0, (dw - canvas.width)/2);
    const minY = Math.min(0, (canvas.height - dh)/2);
    const maxY = Math.max(0, (dh - canvas.height)/2);
    state.x = Math.max(minX, Math.min(maxX, state.x));
    state.y = Math.max(minY, Math.min(maxY, state.y));
  }
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(state.imgLoaded){
      ctx.save();
      ctx.translate(canvas.width/2 + state.x, canvas.height/2 + state.y);
      ctx.rotate(state.angle * Math.PI/180);
      const iw = state.img.width, ih = state.img.height;
      ctx.drawImage(state.img, -iw*state.scale/2, -ih*state.scale/2, iw*state.scale, ih*state.scale);
      ctx.restore();
    }
    if(state.frameLoaded){
      ctx.drawImage(state.frame, 0, 0);
    }
  }

  function loadImageFromFile(file){
    if(!file) return;
    const url = URL.createObjectURL(file);
    const tmp = new Image();
    tmp.onload = () => {
      state.img = tmp;
      state.imgLoaded = true;
      state.angle = 0;
      centerImage();
      draw();
      URL.revokeObjectURL(url);
    };
    tmp.src = url;
  }

  fileInput.addEventListener('change', (e) => loadImageFromFile(e.target.files[0]));

  canvas.addEventListener('pointerdown', (e)=>{if(!state.imgLoaded)return;state.isPanning=true;state.lastX=e.clientX;state.lastY=e.clientY;});
  canvas.addEventListener('pointermove',(e)=>{if(!state.isPanning)return;state.x+=e.clientX-state.lastX;state.y+=e.clientY-state.lastY;state.lastX=e.clientX;state.lastY=e.clientY;clampPan();draw();});
  canvas.addEventListener('pointerup',()=>{state.isPanning=false});

  zoomSlider.addEventListener('input', ()=>{if(!state.imgLoaded)return;state.scale=Math.max(state.minScale,Math.min(4,parseFloat(zoomSlider.value)));clampPan();draw();});
  rotateBtn.addEventListener('click',()=>{if(!state.imgLoaded)return;state.angle=(state.angle+90)%360;centerImage();draw();});
  resetBtn.addEventListener('click',()=>{if(!state.imgLoaded)return;centerImage();draw();});

  function download(mime='image/png',quality){
    const out=document.createElement('canvas');out.width=canvas.width;out.height=canvas.height;const octx=out.getContext('2d');
    if(state.imgLoaded){
      octx.save();octx.translate(out.width/2+state.x,out.height/2+state.y);octx.rotate(state.angle*Math.PI/180);
      octx.drawImage(state.img,-state.img.width*state.scale/2,-state.img.height*state.scale/2,state.img.width*state.scale,state.img.height*state.scale);octx.restore();
    }
    if(state.frameLoaded){octx.drawImage(state.frame,0,0);}
    const url=out.toDataURL(mime,quality);
    const a=document.createElement('a');a.href=url;a.download=mime==='image/png'?'konferencja.png':'konferencja.jpg';a.click();
  }

  downloadPngBtn.addEventListener('click',()=>download('image/png'));
  downloadJpgBtn.addEventListener('click',()=>download('image/jpeg',0.92));
})();
</script>
</body>
</html>
